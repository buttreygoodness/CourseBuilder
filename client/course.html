<template name="course">
  <div class="container">
    {{#if course}}
      {{#with course}}
        <div class="row">
          <div class="span12">
            <h1>{{title}} <span class="muted">{{_id}}</span>  {{> courseControls}}</h1>
          </div>
        </div>
        <div class="row">
          <div class="span3">
            {{#if anyChapters}}
              <div class="accordion" id="sidebarAccordion" style="margin-top: 20px;">
                {{#each chapters}}
                  {{> toc_chapter}}
                {{/each}}
              </div>
            {{/if}}
          </div>
        
          <div class="span9">
            {{#if showCreateChapterDialog}}
              {{> createChapterDialogInline}}
            {{/if}}
            {{#if anySections}}
              {{#each sections}}
                {{> module_section}}
              {{/each}}
            {{/if}}
            {{#if anyChapters}}
              <div id="courseEditor">
              {{#each chapters}}
                {{> module_chapter}}
              {{/each}}
              </div>
            {{else}}
              <div class="well">
                Get started by adding some chapters.
              </div>
            {{/if}}
          </div>
          
        </div>
      {{/with}}
    {{/if}}
  </div>
</template>

<!-- toc_chapter -->

<template name="toc_chapter">
  <div class="accordion-group">
    <div class="accordion-heading">
      <!-- remove data-parent to prevent default toggle behavior -->
      <a class="accordion-toggle" data-toggle="collapse" data-parent="" href="#collapse{{_id}}" style="text-decoration: none;">
        {{title}}
        {{#if anySections}}
        <div class="pull-right">
          <i class="icon-chevron-sign-down"></i>
        </div>
        {{/if}}
      </a> 
    </div>
    {{#if anySections}}
    <div id="collapse{{_id}}" class="accordion-body collapse in">
      <div class="accordion-inner">
        {{#each sections}}
          {{> toc_section}}
        {{/each}}
      </div>
    </div>
    {{/if}}
  </div>
</template>

<!-- toc_section -->

<template name="toc_section">
  <div>
    <a href="#" class="toc_section" style="margin-left: 10px;">{{title}}</a>
  </div>
</template>

<!-- module_chapter -->

<template name="module_chapter">
  <section class="chapter" id="{{_id}}">
    {{> chapterControls}}
    {{#if anySections}}
      {{#each sections}}
        {{> module_section}}
      {{/each}}
    {{/if}}
  </section>
</template>

<!-- chapter_controls -->

<template name="chapterControls">
  {{#with chapter}}
    {{#if selected}}
      {{#if showEditChapterDialog}}
        <h2>{{> editChapterDialogInline}}</h2>
      {{else}}
        {{#if showCreateSectionDialog}}
          <h2>{{title}}</h2>
          {{> createSectionDialogInline}}
        {{else}}
        <h2>{{title}} 
          <a href="#" class="btn btn-mini editChapter">Edit</a>
          <a href="#" class="btn btn-mini removeChapter">Remove</a>
          <a href="#" class="btn btn-mini createSection">Add Section</a>
        </h2>
        {{/if}}
      {{/if}}
    {{else}}
      <h2>{{title}}</h2>
    {{/if}}
  {{/with}}
</template>

<!-- module_section -->

<template name="module_section">
  <section class="section" id="{{_id}}">
    {{> sectionControls}}
    {{#if anyBlocks}}
      {{#each blocks}}
        {{> block_text}}
      {{/each}}
    {{/if}}
  </section>
</template>

<!-- section_controls -->

<template name="sectionControls">
  {{#with section}}
    {{#if selected}}
      {{#if showEditSectionDialog}}
        <h3>{{> editSectionDialogInline}}</h3>
      {{else}}
        {{#if showCreateBlockDialog}}
          <h3>{{title}}</h3>
          {{#if body}}
            {{#markdown}}{{body}}{{/markdown}}
          {{/if}}
          {{> createBlockDialogInline}}
        {{else}}
          <h3>{{title}}
            <a href="#" class="btn btn-mini editSection">Edit</a>
            <a href="#" class="btn btn-mini removeSection">Remove</a>
            <a href="#" class="btn btn-mini createBlock">Add Block</a>
          </h3>
          {{#if body}}
            {{#markdown}}{{body}}{{/markdown}}
          {{/if}}
        {{/if}}
      {{/if}}
    {{else}}
      <h3>{{title}}</h3>
      {{#if body}}
        {{#markdown}}{{body}}{{/markdown}}
      {{/if}}
    {{/if}}
  {{/with}}
</template>

<!-- block_text -->

<template name="block_text">
  <article class="block">
  {{#if selected}}
    {{#if showEditBlockDialog}}
      {{> editBlockDialogInline}}
    {{else}}
      {{#if title}}<h4>{{title}}</h4>{{/if}}
      {{#markdown}}{{body}}{{/markdown}}
      {{> blockControls}}
    {{/if}}
    
  {{else}}
    {{#if title}}<h4>{{title}}</h4>{{/if}}
    {{#markdown}}{{body}}{{/markdown}}
  {{/if}}
  </article>
</template>

<!-- course_controls -->

<template name="courseControls">
  <a href="#" class="btn btn-mini createChapter">Add Chapter</a>
  <!--
    <a href="#" class="btn btn-mini createSection">Add Section</a>
    <a href="#" class="btn btn-mini">Add Block</a> 
  -->
</template>

<!-- block_controls -->

<template name="blockControls">
  <a href="#" class="btn btn-mini editBlock">Edit</a>
  <a href="#" class="btn btn-mini removeBlock">Remove</a>
</template>

<!-- createChapterDialogInline -->

<template name="createChapterDialogInline">
  
  <div class="inline-form">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}
  
    <input type="text" class="title span5" placeholder="Enter a chapter title">
  
    <div class="btn-group pull-right">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Add Chapter</a>
    </div>
  </div>
  
</template>

<!-- editChapterDialogInline -->

<template name="editChapterDialogInline">
  
  <div class="inline-form">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}
  
    <input type="text" class="title span5" placeholder="Enter a chapter title" value="{{title}}">
  
    <div class="btn-group pull-right">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Save</a>
    </div>
  </div>
  
</template>

<!-- createSectionDialogInline -->

<template name="createSectionDialogInline">
  
  <div class="inline-form">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}
  
    <input type="text" class="title span5" placeholder="Enter a title">
    <textarea class="body span5" placeholder="Enter some body copy (optional)"></textarea>
  
    <div class="btn-group pull-right">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Add Section</a>
    </div>
  </div>
  
</template>

<!-- editSectionDialogInline -->

<template name="editSectionDialogInline">
  
  <div class="inline-form">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}
  
    <input type="text" class="title span5" placeholder="Enter a section title" value="{{title}}">
    <textarea class="body span5" placeholder="Enter some body copy.">{{body}}</textarea>
  
    <div class="btn-group pull-right">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Save</a>
    </div>
  </div>
  
</template>

<!-- createBlockDialogInline -->

<template name="createBlockDialogInline">
  
  <div class="inline-form">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}
    
    <input type="text" class="title span5" placeholder="Enter a title (optional)">
    <textarea class="body span5" placeholder="Enter some body copy."></textarea>
  
    <div class="btn-group pull-right">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Add Block</a>
    </div>
  </div>
  
</template>

<!-- editBlockDialogInline -->

<template name="editBlockDialogInline">
  
  <div class="inline-form">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}
    
    <input type="text" class="title span5" placeholder="Enter a title (optional)" value="{{title}}">
    <textarea class="body span5" placeholder="Enter some body copy.">{{body}}</textarea>
  
    <div class="btn-group pull-right">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Save</a>
    </div>
  </div>
  
</template>